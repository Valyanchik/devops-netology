# Домашнее задание к занятию "6.1. Типы и структура СУБД"

## Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определенных данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- Электронные чеки в json виде
- Склады и автомобильные дороги для логистической компании
- Генеалогические деревья
- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации
- Отношения клиент-покупка для интернет-магазина

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.
1. Для хранения данных в json формате подойдет NoSQL БД, в частности MongoDB, работать будет быстрее чем реляционная БД и нет жестких требований к типу данных ( в реляционных как раз будут учитываться типы данных)
2. Насчет этого не уверен, но, наверное подойдут Графовые БД, т.к будут несколько сущностей (склады) и несколько связей между ними(дороги), и можно будет использовать методы дискретной математики для нахождения кратчайшего пути между сущностями согласно теории графов, которая применима к данному типу СУБД
3. Визуально оптимальным решением будет использование иерархической субд, т.к между объектами в БД нужны будут связи между сущностями вида предок-потомок
4. Подойдет key-value субд, в частности Redis, т.к достаточно хранить уникальный идентификатор пользователя и данные кэша, и можно установить time-to-live для каждой записи
5. Подойдет реляционная субд (postgres, mysql и т.д), т.к удобно будет хранить данные о клиенте  и данные о товаре в отдельных таблицах и в отдельной табличке "покупки" формировать данные на основе связи между таблицами "клиент" и "товар"

## Задача 2

Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

- Данные записываются на все узлы с задержкой до часа (асинхронная запись)
- При сетевых сбоях, система может разделиться на 2 раздельных кластера
- Система может не прислать корректный ответ или сбросить соединение

А согласно PACELC-теореме, как бы вы классифицировали данные реализации?

CAP:  
1. partition tolerance, т.к данные будут храниться на всех узлах системы после записи и при падении одного из них все равно будет доступ ко всем данным,  availability - т.к запись будет с задержкой, то не всегда при запросах они будут возвращаться одинакоывми с каждого узла, но они будут возвращаться, т.к узлов несколько, т.е получается CP
2. availability - т.к при сбое доступ к данным останется при запросах либо к одному либо к другому кластеру, partition tolerance - т.к при разделеннии системы на 2 кластера данные могут начать записываться в разные кластеры и при восстановлении системы в исходное состояние в одной системе будут храниться разные данные, что противоречит consistency, получаем AP
3. если может не прислать ответ на запрос, то свойством availability она не обладает, значит остается CP(не совсем понятно выражение "корректный ответ", поэтому я включил в ответ свойство consistency)

PACELC:
1. т.к данные пишуться на все узлы то имеется свойство consistency, данные пишуться с задержкой - мы имеем свойства latency, согласно PACELC система может быть либо PAC либо LC, в данном случае это LC
2. Разделение системы на два кластера не говорит о том, что доступ к данным будет с задержкой, значит свойство latency субд не обладает, плюс мы потеряем свойство consistency, т.к данные на двух кластерах могут различаться (кто то запишет в один кластер что то, а другой кто то в второй кластер и при восстановлении системы в исходное состояние данные будут различаться), в данном случаем система будет PAC
3. Данная система не будет обладать свойством availability, поэтому данная система согласно PACELC Будет LC

## Задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?  
ACID и BASE противопоставляющие принципы, ACID про надежность, BASE про производительность. Согласно ACID все транзакции должны завершаться вне зависимости от аппаратных проблем, не влиять на результаты друг друга и результат этих транзакций будет ограничен параметрами СУБД, при BASE транзакции могут не всегда завершиться в угоду скорости(зафиксируются только критичные транзакции), но это позволит ускорить процесс обработки данных (из сетевого мира аналогом, как мне кажется будут TCP и UDP)

## Задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни
- реакция на истечение таймаута

Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). 
Что это за система? Какие минусы выбора данной системы?
pub\sub система - система издатель-подписчик (невероятно, не правда ли)), издатель публикует какое либо сообщение на сервере определяя сообщение тегами, на основе которых можно определить, к какому типу подписки данное сообщение принадлежит, и далее это сообщение уже может получить любой подписчик с соответствующей подпиской, однако, возникает ряд вопросов по реализации данных систем: 
1. Где и как будут храниться адреса издателей и подписчиков, параметры самих подписок?
2. Сколько должно храниться сообщение в системе (time-to-live)
3. Нужна организация очереди сообщений, т.к не все подписчики могут быть активны в данный момент и часть сообщений могут утеряться из-за сетевых проблем
4. Определить, что именно будет реакцией на истечение таймаута (повторная отправка, удаление сообщения), и как она повлияет на работу системы( к примеру, многократная повторная отправка подписчику, который неактивен в системе в течении двух часов может излишне нагружать систему, и таких подписчиков может быть много)